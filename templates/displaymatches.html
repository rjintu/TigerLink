<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel='stylesheet' type='text/css' href='static/style.css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans">
</head>

<body>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
    -->
</body>
<style>
    body {
        padding-top: 80px;
    }
</style>

<header>
    {% with bold='matches' %}
    {% include "navbar.html" %}
    {% endwith %}
</header>

<body id="generic-body">
    <div class="container">
        <div class="row justify-content-center">
            <!-- col 1 -->

            <table class="table table-hover table-responsive">
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Student Year</th>
                        <th>Alumni Name</th>
                        <th>Alumni Year</th>
                        <th>Similarity 
                            <button type="button" class="btn btn-sm btn-info" data-toggle="popover">
                                <img src="../static/img/info.png" width="30" height="auto" alt="">
                            </button>
                         </th>
                    </tr>
                </thead>
                <tbody>
                    {% for match in matches: %}
                    {% if (match|length) > 2 %}
                    <tr class="clickable-row" id='{{match[0]}}' value='{{match[1]}}'>
                        {% for i in range (2, 7): %}
                        {% if (i == 6) %}
                        <td>{{ match[i] }}%</td>
                        {% else %}
                        <td>{{ match[i] }}</td>
                        {% endif %}
                        {% endfor %}
                    </tr>
                    {% endif %}
                    <!-- <p id="details"></p> -->

                    {% endfor %}
                </tbody>
            </table>
            <div class="w-50 justify-content-left">
                <p id="details"></p>
            </div>
            <div class="d-flex justify-content-center">
                <button type="submit" id="closeMatch" class="btn btn-success">Done</button>
            </div>


            <!-- <a tabindex="0" class="button" id='test123' value='test123' role="button" data-bs-toggle="popover"
                data-bs-content="testing" data-bs-trigger="focus" title="Match Info">Dismissible
                popover</a> -->
        </div>
    </div>

    <!-- button and modal -->
    <!-- <button type="button" class="btn btn-primary" id="modalButton" data-bs-toggle="modal"
        data-bs-target="#staticBackdrop">
        Launch static backdrop modal
    </button>

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Match Info</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="test123">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div> -->



    <script>
        'use strict';

        // var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        // var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        //     return new bootstrap.Popover(popoverTriggerEl)
        // })

        // var popover = new bootstrap.Popover(document.querySelector('.popover-dismiss'), {
        //     trigger: 'focus'
        // })

        // var myModal = document.getElementById('myModal')
        // var myInput = document.getElementById('myInput')

        // myModal.addEventListener('shown.bs.modal', function () {
        //     myInput.focus()
        // })

        function handleResponse(response) {
            $('#details').html(response);
            // let b = document.querySelector('#test123');
            // b.setAttribute('title', 'helloButton');
            // print(response)
            // $('#modalButton').on('click', function () {
            //     $('<p>Text</p>').appendTo('#test123');
            // });
        }

        let request = null;


        function setup() {
            $('[data-toggle="popover"]').popover({
                placement : 'top',
                trigger : 'hover',
                title: 'Similarity Score',
                content: 'The similarity score is a percentage that quantifies the overlap in majors, careers, and organizations between the student and the alumni. It currently assigns an equal weightage to each of these three categories, although the weighting may be adjusted by the admin. Low similarity scores can be attributed to a class imbalance between students and alumni in the database, as well as the matching algorithm\'s philosophy that a weak match is better than no match at all.'
            });

            $("#closeMatch").hide();
            $('.clickable-row').click(
                (e) => {

                    let student = $(e.target).closest('tr').attr('id');
                    let alum = $(e.target).closest('tr').attr('value');

                    let studentU = encodeURIComponent(student);
                    let alumU = encodeURIComponent(alum);

                    let url = "/matchdetails?student=" + studentU + "&alum=" + alumU;
                    // let url = "/timeline"

                    console.log(url);

                    if (request != null)
                        request.abort();

                    request = $.ajax({
                        type: 'GET',
                        url: url,
                        success: handleResponse
                    });

                    $("#details").show();
                    $("#closeMatch").show();
                }
            );


            $("#closeMatch").click(function () {
                $("#details").hide();
                $("#closeMatch").hide();
            });


            // $('#modalButton').click(
            //     (e) => {
            //         // $('<p>Text</p>').appendTo('#test123');
            //     }
            // );

        }


        $(document).ready(setup);

    </script>
</body>

</html>