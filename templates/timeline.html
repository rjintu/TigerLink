<!doctype html>
<html lang="en">


<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="static/css/pe-icon-7-stroke.css" rel="stylesheet" />
    <link href="static/css/ct-navbar.css" rel="stylesheet" />

    <!-- Bootstrap CSS and stylesheet -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans">
    <link rel='stylesheet' type='text/css' href='static/style.css'>

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    {% with bold='timeline' %}
    {% include "navbar.html" %}
    {% endwith %}

</head>


<script>
    "use strict";

    let request = null;

    function handleResponse(response) {
        $('#detailsBody').html(response);
        $('#detailsModal').modal('show');
    }

    function setup() {
        // pull firstLogin from URL
        const queryString = window.location.search;
        // console.log(queryString);
        const urlParams = new URLSearchParams(queryString);
        const firstLogin = urlParams.get('firstLogin')
        //console.log(firstLogin)

        var myModal = new bootstrap.Modal(document.getElementById('firstTimeUser'), {
            keyboard: false
        })

        // show if URL includes firstLogin as 'True'
        if (firstLogin == 'True') {
            myModal.show()
        }

        $('#closeDetailsBtn').click(function () {
            $('#detailsModal').modal('hide');
        });

        $('.profile').click((e) => {
            let profileid = $(e.target).closest('a').attr('profileID');
            let profileidU = encodeURIComponent(profileid);

            let url = "/genericdetails?profileid=" + profileidU;
            if (request != null)
                request.abort();

            request = $.ajax({
                type: 'GET',
                url: url,
                success: handleResponse
            });
        });
    }

    $(document).ready(setup);
</script>


<style>
    body {
        padding-top: 65px;
    }

    .profile:hover {
        cursor: pointer;
        opacity: 0.6;
    }
</style>

<body id="generic-body">
    <!-- postid TEXT, authorname TEXT, authorid TEXT, posttime TEXT, posttitle TEXT, postcontent TEXT, imgurl TEXT, privacy TEXT, communities TEXT -->
    {% for res in posts: %}
    <div class="container mt-5 mb-5">
        <div class="row">
            <div class="col-md-2 col-12 offset-2" style="display: block; text-align: center;">
                <table>
                    <tbody>
                        <tr style="text-align: center;">
                            <a class="profile" profileID="{{ res[1] }}">
                                <img src={{res[9]}} style="width: 100%; max-width: 100px;" class="rounded-circle"
                                    onerror="this.style.display='none'">
                            </a>
                            <br>
                            <h5 style="text-align: center;">{{ res[2] }}</h5>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col" style="display: block;">
                <div class="card bg-light shadow p-3 mb-5 bg-white rounded w-50">
                    <img src={{res[6]}} class="card-img-top" onerror="this.style.display='none'">
                    <div class="card-body">
                        <div class="card-title h5"> {{res[4]}} </div>
                        <div class="mb-2 text-muted card-subtitle h6">
                            {{res[3]}}
                        </div>
                        <div class="mb-2 h6">
                            {{res[5]}}
                        </div>
                        <!--Show the delete button if the user authored the post-->
                        {% if (profileid == res[1]) %}
                        <div class="d-flex mt-3">
                            <button class="btn btn-danger ms-auto deleteBtn" id="{{res[0]}}">Delete</button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% endfor %}

    <script>
        function setup() {
            $('.deleteBtn').click((e) => {
                let postid = $(e.target).attr('id');
                $.post("deletepost", { postid: postid })
                    .done(function () { location.reload(); })
                    .fail(function () { alert('An error occurred.'); });
            });
        }

        $(document).ready(setup);
    </script>

    <!-- for testing: https://localhost:8888/timeline?firstLogin=True -->
    <!-- Modal -->
    <div id="firstTimeUser" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel"><strong>Success!</strong></h5>
                    <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
                </div>
                <div class="modal-body" id="test123">
                    Welcome to TigerLink! Your account has been successfully created. Please take a moment to
                    familiarize yourself with the navigation bar at the top. Enjoy!
                </div>
                <div class="modal-footer">
                    <a href="/timeline" class="btn btn-secondary mx-auto d-block">Got it!</a>
                </div>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Details</h5>
                </div>
                <div class="modal-body" id="detailsBody">
                </div>
                <div class="modal-footer">
                    <a href="#" id="closeDetailsBtn" class="btn btn-success d-block">Done</a>
                </div>
            </div>
        </div>
    </div>

</body>

</html>